{% extends "properties/base.html" %}
{% load static %}
{% block content %}

<!-- Заголовок -->
<div class="text-center my-4">
    <h1>Недвижимость в Болгарии</h1>
</div>

<!-- Фильтр по комнатам -->
<div class="text-center my-3">
    <h5>Комнаты</h5>
    <div class="btn-group" role="group">
        <a href="{% url 'index' %}" class="btn btn-outline-secondary {% if not selected_bedrooms %}active{% endif %}">
            Все
        </a>
        <a href="?bedrooms=studio" class="btn btn-outline-secondary {% if selected_bedrooms == 'studio' %}active{% endif %}">
            Студия
        </a>
        <a href="?bedrooms=1" class="btn btn-outline-secondary {% if selected_bedrooms == '1' %}active{% endif %}">
            1
        </a>
        <a href="?bedrooms=2" class="btn btn-outline-secondary {% if selected_bedrooms == '2' %}active{% endif %}">
            2
        </a>
        <a href="?bedrooms=3" class="btn btn-outline-secondary {% if selected_bedrooms == '3' %}active{% endif %}">
            3
        </a>
    </div>
</div>

<!-- Фильтр по площади -->
<div class="text-center my-3">
    <h5>Площадь</h5>
    <div class="btn-group" role="group">
        <a href="{% url 'index' %}{% if selected_bedrooms %}?bedrooms={{ selected_bedrooms }}{% endif %}"
           class="btn btn-sm btn-outline-primary {% if not selected_area %}active{% endif %}">
            Все
        </a>
        <a href="?{% if selected_bedrooms %}bedrooms={{ selected_bedrooms }}&{% endif %}area=small"
           class="btn btn-sm btn-outline-primary {% if selected_area == 'small' %}active{% endif %}">
            < 50 м²
        </a>
        <a href="?{% if selected_bedrooms %}bedrooms={{ selected_bedrooms }}&{% endif %}area=medium"
           class="btn btn-sm btn-outline-primary {% if selected_area == 'medium' %}active{% endif %}">
            50–90 м²
        </a>
        <a href="?{% if selected_bedrooms %}bedrooms={{ selected_bedrooms }}&{% endif %}area=large"
           class="btn btn-sm btn-outline-primary {% if selected_area == 'large' %}active{% endif %}">
            > 90 м²
        </a>
    </div>
</div>

<!-- Сортировка -->
<div class="text-center my-3">
    <h5>Сортировка</h5>
    <div class="btn-group" role="group">
        <a href="?{% if selected_bedrooms %}bedrooms={{ selected_bedrooms }}&{% endif %}{% if selected_area %}area={{ selected_area }}&{% endif %}sort=price_asc"
           class="btn btn-sm btn-outline-success {% if selected_sort == 'price_asc' %}bg-success text-white{% endif %}">
            Дешёвые
        </a>
        <a href="?{% if selected_bedrooms %}bedrooms={{ selected_bedrooms }}&{% endif %}{% if selected_area %}area={{ selected_area }}&{% endif %}sort=price_desc"
           class="btn btn-sm btn-outline-success {% if selected_sort == 'price_desc' %}bg-success text-white{% endif %}">
            Дорогие
        </a>
        <a href="?{% if selected_bedrooms %}bedrooms={{ selected_bedrooms }}&{% endif %}{% if selected_area %}area={{ selected_area }}&{% endif %}sort=area_asc"
           class="btn btn-sm btn-outline-success {% if selected_sort == 'area_asc' %}bg-success text-white{% endif %}">
            Площадь ↑
        </a>
        <a href="?{% if selected_bedrooms %}bedrooms={{ selected_bedrooms }}&{% endif %}{% if selected_area %}area={{ selected_area }}&{% endif %}sort=area_desc"
           class="btn btn-sm btn-outline-success {% if selected_sort == 'area_desc' %}bg-success text-white{% endif %}">
            Площадь ↓
        </a>
    </div>
</div>

<!-- Список недвижимости -->
<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    {% for prop in properties %}
        <div class="col">
            <div class="card h-100 border-0 shadow-sm">
                {% if prop.image %}
                    <img src="{{ prop.image.url }}" class="card-img-top" alt="{{ prop.title }}" style="height: 200px; object-fit: cover;">
                {% else %}
                    <img src="https://via.placeholder.com/300x200?text=Нет+фото" class="card-img-top" alt="Нет фото" style="height: 200px; object-fit: cover;">
                {% endif %}

                <div class="card-body">
                    <h5 class="card-title">{{ prop.title }}</h5>
                    <p class="card-text text-muted small">
                        {{ prop.description|truncatewords:12 }}
                    </p>
                    <div class="d-flex flex-wrap gap-2 mb-2">
                        <span class="badge bg-primary">
                            {% if prop.bedrooms == 0 %}Студия{% else %}{{ prop.bedrooms }} комн.{% endif %}
                        </span>
                        <span class="badge bg-secondary">{{ prop.area }} м²</span>
                        <span class="badge bg-info text-dark">{{ prop.location }}</span>
                    </div>
                </div>

                <div class="card-footer bg-white border-0">
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="text-dark fw-bold">₽ {{ prop.price|floatformat:0 }} </span>
                        <a href="{% url 'property_detail' prop.id %}" class="btn btn-primary btn-sm">Подробнее</a>
                    </div>
                </div>
            </div>
        </div>
    {% empty %}
        <div class="col-12">
            <div class="alert alert-info text-center py-4">
                <h5>Недвижимость не найдена</h5>
                <p>Попробуйте изменить фильтры.</p>
            </div>
        </div>
    {% endfor %}
</div>

<!-- Пагинация (если включена) -->
{% if is_paginated %}
    <div class="d-flex justify-content-center my-4">
        <nav>
            <ul class="pagination">
                {% if page_obj.has_previous %}
                    <li class="page-item">
                        <a class="page-link" href="?{% if selected_bedrooms %}bedrooms={{ selected_bedrooms }}&{% endif %}{% if selected_area %}area={{ selected_area }}&{% endif %}{% if selected_sort %}sort={{ selected_sort }}&{% endif %}page={{ page_obj.previous_page_number }}">
                            Назад
                        </a>
                    </li>
                {% endif %}

                <li class="page-item disabled">
                    <span class="page-link">Страница {{ page_obj.number }} из {{ page_obj.paginator.num_pages }}</span>
                </li>

                {% if page_obj.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="?{% if selected_bedrooms %}bedrooms={{ selected_bedrooms }}&{% endif %}{% if selected_area %}area={{ selected_area }}&{% endif %}{% if selected_sort %}sort={{ selected_sort }}&{% endif %}page={{ page_obj.next_page_number }}">
                            Вперёд
                        </a>
                    </li>
                {% endif %}
            </ul>
        </nav>
    </div>
{% endif %}

{% endblock %}